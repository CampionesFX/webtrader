{"version":3,"sources":["../../../../src/accountstatus/accountstatus.es6"],"names":["AccountStatus","_this","$ele","events","on","response","authorize","is_virtual","is","slideUp","parent","animate","top","getStatus","account_status","website_status","get_settings","financial_assessment","mt5_account","tc_accepted","financial_assessment_submitted","get_account_status","status","indexOf","is_mlt","test","landing_company_name","is_mf","is_cr","has_mt5_account","mt5_login_list","length","terms_conditions_version","client_tnc_status","risk_classification","Object","keys","get_financial_assessment","checkStatus","Promise","all","send","cached","model","tc","message","i18n","replace","is_valid","callback","init","tax","risk","authenticate","balance","unwelcome","lang","local_storage","get","value","win","window","open","focus","invalid_obj","find","obj","html","slideDown"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MASMA,a;AAEJ,6BAAc;AAAA;;AAAA;;AACZ,UAAMC,QAAQ,IAAd;AAAA,UACEC,OAAO,sBAAE,mBAAF,CADT;AAEA;AACA,kCAAQC,MAAR,CAAeC,EAAf,CAAkB,OAAlB;AAAA,gEAA2B,iBAAOC,QAAP;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,wBACrB,CAACA,SAASC,SAAT,CAAmBC,UAApB,KAAmC,CADd;AAAA;AAAA;AAAA;;AAEvBL,uBAAKM,EAAL,CAAQ,UAAR,KAAuBN,KAAKO,OAAL,CAAa,GAAb,CAAvB;AACA,wCAAE,mBAAF,EAAuBC,MAAvB,GAAgCC,OAAhC,CAAwC;AACtCC,yBAAK;AADiC,mBAAxC;AAHuB;;AAAA;AAAA;AAAA,yBAUoBX,MAAMY,SAAN,CAAgBR,SAASC,SAAzB,CAVpB;;AAAA;AAAA;AAAA;AASlBQ,gCATkB;AASFC,gCATE;AAScC,8BATd;AAUvBC,sCAVuB;AAUDC,6BAVC;;AAWzBjB,wBAAMkB,WAAN,GAAoB,KAApB;AACAlB,wBAAMmB,8BAAN,GAAuCN,eAAeO,kBAAf,CAAkCC,MAAlC,CAAyCC,OAAzC,CAAiD,mCAAjD,KAAwF,CAAC,CAAhI;AACAtB,wBAAMuB,MAAN,GAAe,YAAYC,IAAZ,CAAiBpB,SAASC,SAAT,CAAmBoB,oBAApC,CAAf;AACAzB,wBAAM0B,KAAN,GAAc,kBAAkBF,IAAlB,CAAuBpB,SAASC,SAAT,CAAmBoB,oBAA1C,CAAd;AACAzB,wBAAM2B,KAAN,GAAc,gBAAgBH,IAAhB,CAAqBpB,SAASC,SAAT,CAAmBoB,oBAAxC,CAAd;AACAzB,wBAAM4B,eAAN,GAAwBX,YAAYY,cAAZ,CAA2BC,MAA3B,GAAoC,CAA5D;;AAEA;AACA,sBAAIhB,kBAAkBA,eAAeA,cAAjC,IAAmDC,YAAnD,IAAmEA,aAAaA,YAApF,EAAkG;AAChGf,0BAAMkB,WAAN,GAAoBJ,eAAeA,cAAf,CAA8BiB,wBAA9B,KAA2DhB,aAAaA,YAAb,CAA0BiB,iBAAzG;AACD;;AAED;AACA,sBAAInB,eAAeO,kBAAf,CAAkCa,mBAAlC,KAA0D,MAA1D,IAAoEjB,oBAAxE,EAA8F;AAC5FhB,0BAAMmB,8BAAN,GAAuCnB,MAAMmB,8BAAN,IAAwCe,OAAOC,IAAP,CAAYnB,qBAAqBoB,wBAAjC,EAA2DN,MAA3D,KAAsE,CAArJ;AACD;;AAED9B,wBAAMqC,WAAN,CAAkBjC,SAASC,SAA3B,EAAsCQ,eAAeO,kBAAf,CAAkCC,MAAxE;;AA5ByB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAA3B;;AAAA;AAAA;AAAA;AAAA;;AA+BA;AACA,kCAAQnB,MAAR,CAAeC,EAAf,CAAkB,QAAlB,EAA4B;AAAA,eAAKF,KAAKM,EAAL,CAAQ,UAAR,KAAuBN,KAAKO,OAAL,CAAa,GAAb,CAA5B;AAAA,OAA5B;AACD;;;;kCAEW;AACV;AACA,eAAO8B,QAAQC,GAAR,CAAY,CACjB,4BAAQC,IAAR,CAAa,EAAEpB,oBAAoB,CAAtB,EAAb,CADiB,EAEjB,4BAAQoB,IAAR,CAAa,EAAE,kBAAkB,CAApB,EAAb,CAFiB,EAGjB,4BAAQA,IAAR,CAAa,EAAE,gBAAgB,CAAlB,EAAb,CAHiB,EAIjB,4BAAQC,MAAR,CAAeD,IAAf,CAAoB,EAAEJ,0BAA0B,CAA5B,EAApB,CAJiB,EAKjB,4BAAQI,IAAR,CAAa,EAAEX,gBAAgB,CAAlB,EAAb,CALiB,CAAZ,CAAP;AAOD;;;kCAEWxB,S,EAAWgB,M,EAAQ;AAC7B;AACA,YAAMpB,OAAO,sBAAE,mBAAF,CAAb;AAAA,YACED,QAAQ,IADV;AAEA;AACA;AACA,YAAM0C,QAAQ;AACZC,cAAI;AACFC,qBAAS,qGACNC,IADM,GACCC,OADD,CACS,MADT,EACiB,cADjB,EACiCA,OADjC,CACyC,MADzC,EACiD,MADjD,CADP;AAGFC,sBAAU;AAAA,qBAAK/C,MAAMkB,WAAX;AAAA,aAHR;AAIF8B,sBAAU,aAAGC;AAJX,WADQ;AAOZC,eAAK;AACHN,qBAAS,2FACNC,IADM,GACCC,OADD,CACS,MADT,EACiB,cADjB,EACiCA,OADjC,CACyC,MADzC,EACiD,MADjD,CADN;AAGHC,sBAAU;AAAA,qBAAK,CAAC/C,MAAM0B,KAAP,IAAgB,sBAAsBF,IAAtB,CAA2BH,MAA3B,CAArB;AAAA,aAHP;AAIH2B,sBAAU,yBAAeC;AAJtB,WAPO;AAaZE,gBAAM;AACJP,qBAAS,oGACNC,IADM,GACCC,OADD,CACS,MADT,EACiB,cADjB,EACiCA,OADjC,CACyC,MADzC,EACiD,MADjD,CADL;AAGJC,sBAAU;AAAA,qBAAK/C,MAAMmB,8BAAX;AAAA,aAHN;AAIJ6B,sBAAU,8BAAoBC;AAJ1B,WAbM;AAmBZG,wBAAc;AACZR,qBAAS,oGAAoGC,IAApG,GACNC,OADM,CACE,MADF,EACU,cADV,EAC0BA,OAD1B,CACkC,MADlC,EAC0C,MAD1C,CADG;AAGZC,sBAAU;AAAA,qBAAM,iBAAgBvB,IAAhB,CAAqBH,MAArB,MAAiC,mBAAmBG,IAAnB,CAAwBH,MAAxB,KAAmCrB,MAAM2B,KAA1E,CAAD;AACb;AACI,iBAAC,gBAAgBH,IAAhB,CAAqBH,MAArB,CAAD,IAAiCrB,MAAM2B,KAAvC,KAAiD,CAACtB,UAAUgD,OAAX,GAAqB,GAArB,IAA4B,CAACrD,MAAM4B,eAApF;AAFI;AAAA,aAHE;AAMZoB,sBAAU,qBAAOC;AANL,WAnBF;AA2BZK,qBAAW;AACTV,qBAAS,sFACNC,IADM,GACCC,OADD,CACS,MADT,EACiB,cADjB,EACiCA,OADjC,CACyC,MADzC,EACiD,MADjD,CADA;AAGTC,sBAAU;AAAA,qBAAK,CAAC,0CAA0CvB,IAA1C,CAA+CH,MAA/C,CAAN;AAAA,aAHD;AAIT2B,sBAAU,oBAAM;AACd,kBAAMO,OAAOC,cAAcC,GAAd,CAAkB,MAAlB,EAA0BC,KAA1B,GAAkCF,cAAcC,GAAd,CAAkB,MAAlB,EAA0BC,KAA5D,GAAoE,IAAjF;AACA,kBAAMC,MAAMC,OAAOC,IAAP,CAAY,2BAA2BN,IAA3B,GAAkC,eAA9C,CAAZ;AACAI,kBAAIG,KAAJ;AACD;AARQ;AA3BC,SAAd;;AAuCA;AACA,YAAMC,cAAc,iBAAEC,IAAF,CAAOtB,KAAP,EAAc;AAAA,iBAAO,CAACuB,IAAIlB,QAAJ,EAAR;AAAA,SAAd,CAApB;AACA,YAAIgB,WAAJ,EAAiB;AACf;AACA9D,eAAKiE,IAAL,CAAUH,YAAYnB,OAAtB;AACA;AACA3C,eAAK+D,IAAL,CAAU,GAAV,EAAe7D,EAAf,CAAkB,OAAlB,EAA2B4D,YAAYf,QAAvC;;AAEA,cAAI/C,KAAKM,EAAL,CAAQ,SAAR,CAAJ,EAAwB;AACtBN,iBAAKkE,SAAL,CAAe,GAAf;AACA,kCAAE,mBAAF,EAAuB1D,MAAvB,GAAgCC,OAAhC,CAAwC;AACtCC,mBAAK;AADiC,aAAxC;AAGD;AACF,SAZD,MAYO;AACLV,eAAKM,EAAL,CAAQ,UAAR,KAAuBN,KAAKO,OAAL,CAAa,GAAb,CAAvB;AACA,gCAAE,mBAAF,EAAuBC,MAAvB,GAAgCC,OAAhC,CAAwC;AACtCC,iBAAK;AADiC,WAAxC;AAGD;AAEF;;;;;;AAGI,MAAMsC,sBAAO,IAAIlD,aAAJ,EAAb;;oBAEQ;AACbkD;AADa,G","file":"accountstatus.js","sourcesContent":["import $ from \"jquery\";\nimport liveapi from \"../websockets/binary_websockets\";\nimport _ from \"lodash\";\nimport notice from \"shownotice/shownotice\";\nimport tc from \"../tc/tc\";\nimport financialassessment from \"../financialassessment/financialassessment\";\nimport taxInformation from \"../taxInformation/taxInformation\";\nimport \"../common/util\";\n\nclass AccountStatus {\n\n  constructor() {\n    const _this = this,\n      $ele = $(\"#msg-notification\");\n    // Initiating account check on login.\n    liveapi.events.on(\"login\", async (response) => {\n      if (+response.authorize.is_virtual === 1) {\n        $ele.is(\":visible\") && $ele.slideUp(500);\n        $('.webtrader-dialog').parent().animate({\n          top: '110px'\n        })\n        return;\n      }\n\n      const [account_status, website_status, get_settings,\n        financial_assessment, mt5_account] = await _this.getStatus(response.authorize);\n      _this.tc_accepted = false;\n      _this.financial_assessment_submitted = account_status.get_account_status.status.indexOf(\"financial_assessment_not_complete\") ==-1;\n      _this.is_mlt = /^malta$/gi.test(response.authorize.landing_company_name);\n      _this.is_mf = /^maltainvest$/gi.test(response.authorize.landing_company_name);\n      _this.is_cr = /^costarica$/gi.test(response.authorize.landing_company_name);\n      _this.has_mt5_account = mt5_account.mt5_login_list.length > 0;\n\n      // Check whether the user has accepted the T&C.\n      if (website_status && website_status.website_status && get_settings && get_settings.get_settings) {\n        _this.tc_accepted = website_status.website_status.terms_conditions_version === get_settings.get_settings.client_tnc_status;\n      }\n\n      // Check whether the high risk clients have submitted the financial_assessment form.\n      if (account_status.get_account_status.risk_classification === \"high\" && financial_assessment) {\n        _this.financial_assessment_submitted = _this.financial_assessment_submitted && Object.keys(financial_assessment.get_financial_assessment).length !== 0;\n      }\n      \n      _this.checkStatus(response.authorize, account_status.get_account_status.status);\n    });\n\n    // Hide msg bar on logout.\n    liveapi.events.on('logout', _ => $ele.is(\":visible\") && $ele.slideUp(500));\n  }\n\n  getStatus() {\n    // Getting account status, website status, account settings and financial assessment.\n    return Promise.all([\n      liveapi.send({ get_account_status: 1 }),\n      liveapi.send({ \"website_status\": 1 }),\n      liveapi.send({ \"get_settings\": 1 }),\n      liveapi.cached.send({ get_financial_assessment: 1 }),\n      liveapi.send({ mt5_login_list: 1 })\n    ]);\n  }\n\n  checkStatus(authorize, status) {\n    // Message container\n    const $ele = $(\"#msg-notification\"),\n      _this = this;\n    // Contains validations, messages, onclick callbacks.\n    // Maintaining the order of priority.\n    const model = {\n      tc: {\n        message: \"Please [_1]accept the updated Terms and Conditions[_2] to lift your withdrawal and trading limits.\"\n          .i18n().replace(\"[_1]\", \"<a href='#'>\").replace(\"[_2]\", \"</a>\"),\n        is_valid: _ => _this.tc_accepted,\n        callback: tc.init\n      },\n      tax: {\n        message: \"Please [_1]complete your account profile[_2] to lift your withdrawal and trading limits.\"\n          .i18n().replace(\"[_1]\", \"<a href='#'>\").replace(\"[_2]\", \"</a>\"),\n        is_valid: _ => !_this.is_mf || /crs_tin_information/.test(status),\n        callback: taxInformation.init\n      },\n      risk: {\n        message: \"Please complete the [_1]financial assessment form[_2] to lift your withdrawal and trading limits.\"\n          .i18n().replace(\"[_1]\", \"<a href='#'>\").replace(\"[_2]\", \"</a>\"),\n        is_valid: _ => _this.financial_assessment_submitted,\n        callback: financialassessment.init\n      },\n      authenticate: {\n        message: \"[_1]Authenticate your account[_2] now to take full advantage of all withdrawal options available.\".i18n()\n          .replace(\"[_1]\", \"<a href='#'>\").replace(\"[_2]\", \"</a>\"),\n        is_valid: _ => (/authenticated/.test(status) && (/age_verification/.test(status) || _this.is_cr))\n          //For cr accounts show authentication msg if the user balance is more than 200 or has mt5 account\n          || (!/authenticated/.test(status) && _this.is_cr && (+authorize.balance < 200 || !_this.has_mt5_account)),\n        callback: notice.init\n      },\n      unwelcome: {\n        message: \"Your account is restricted. Kindly [_1]contact customer support[_2] for assistance.\"\n          .i18n().replace(\"[_1]\", \"<a href='#'>\").replace(\"[_2]\", \"</a>\"),\n        is_valid: _ => !/(unwelcome|(cashier|withdrawal)_locked)/.test(status),\n        callback: () => {\n          const lang = local_storage.get(\"i18n\").value ? local_storage.get(\"i18n\").value : \"en\";\n          const win = window.open(\"http://www.binary.com/\" + lang + \"/contact.html\");\n          win.focus();\n        }\n      }\n    }\n\n    // Getting the invalid account status.\n    const invalid_obj = _.find(model, obj => !obj.is_valid())\n    if (invalid_obj) {\n      // Show message\n      $ele.html(invalid_obj.message);\n      // bind click event to open specific dialogs with instructions.\n      $ele.find(\"a\").on(\"click\", invalid_obj.callback);\n\n      if ($ele.is(\":hidden\")) {\n        $ele.slideDown(500);\n        $('.webtrader-dialog').parent().animate({\n          top: '140px'\n        })\n      }\n    } else {\n      $ele.is(\":visible\") && $ele.slideUp(500);\n      $('.webtrader-dialog').parent().animate({\n        top: '110px'\n      })\n    }\n\n  }\n}\n\nexport const init = new AccountStatus();\n\nexport default {\n  init\n}\n"]}