{"version":3,"sources":["../../../../src/instruments/instruments.es6"],"names":["refresh_active_symbols","send","active_symbols","then","data","active_markets","_","groupBy","map","symbols","sym","head","market","name","display_name","market_display_name","submarkets","submarket","submarket_display_name","instruments","push","symbol","value","markets","m","sortMenu","find","remove","root","appendTo","refreshMenu","onMenuItemClick","li","delayAmount","displaySymbol","addNewWindow","instrumentCode","instrumentName","timePeriod","type","chartable_markets","init","cached","trading_times","Date","toISOString","slice","extractChartableMarkets","require","liveapi","events","on","getMarketData","isMarketDataPresent","marketDataDisplayName","marketData","present","instrumentObj","each","key","trim","getSpecificMarketData","isEmptyObject"],"mappings":"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","file":"instruments.js","sourcesContent":["/**\n * Created by arnab on 2/12/15.\n */\n\nimport $ from \"jquery\";\nimport $ui from \"jquery-ui\";\nimport liveapi from \"websockets/binary_websockets\";\nimport menu from \"navigation/menu\";\nimport chartWindow from \"charts/chartWindow\";\nimport \"jquery-growl\";\nimport \"common/util\";\n\nfunction refresh_active_symbols() {\n    liveapi\n        .send({ active_symbols: 'brief', \"landing_company\": \"champion\" })\n        .then(function(data) {\n            const active_symbols = [];\n            const active_markets = _(data.active_symbols).groupBy('market').map(function(symbols) {\n                const sym = _.head(symbols);\n                const market = { name: sym.market, display_name: sym.market_display_name };\n                market.submarkets = _(symbols).groupBy('submarket').map(function(symbols) {\n                    const sym = _.head(symbols);\n                    const submarket = { name: sym.submarket, display_name: sym.submarket_display_name };\n                    submarket.instruments = _.map(symbols, function(sym) {\n                        active_symbols.push(sym.symbol);\n                        return {\n                            symbol: sym.symbol,\n                            display_name: sym.display_name,\n                        };\n                    });\n                    return submarket;\n                }).value();\n                return market;\n            }).value();\n            markets = active_markets.map(function(m) {\n                return {\n                    display_name: m.display_name,\n                    name: m.name,\n                    submarkets: m.submarkets\n                }\n            });\n\n            //console.warn(markets, chartable_markets);\n            markets = menu.sortMenu(markets);\n\n            const instruments = $(\"#nav-menu\").find(\".instruments\");\n            instruments.find('> ul').remove();\n            const root = $(\"<ul>\").appendTo(instruments); /* add to instruments menu */\n            menu.refreshMenu(root, markets, onMenuItemClick);\n        });\n}\n\nfunction onMenuItemClick(li) {\n\n    const delayAmount = li.data('delay_amount'), //this is in minutes\n        symbol = li.data('symbol'),\n        displaySymbol = li.data('display_name');\n\n    chartWindow.addNewWindow({\n        instrumentCode: symbol,\n        instrumentName: displaySymbol,\n        timePeriod: '1d',\n        type: 'candlestick',\n        delayAmount: delayAmount\n    });\n\n}\n\nlet markets = [];\nlet chartable_markets = [];\n\nexport const init = function() {\n    /* cache the result of trading_times call, because assetIndex needs the same data */\n    return liveapi\n        .cached.send({ trading_times: new Date().toISOString().slice(0, 10) })\n        .then(function(data) {\n            chartable_markets = menu.extractChartableMarkets(data);\n            refresh_active_symbols();\n            require(['websockets/binary_websockets'], function(liveapi) {\n                liveapi.events.on('login', refresh_active_symbols);\n                liveapi.events.on('logout', refresh_active_symbols);\n            });\n            /* refresh menu on mouse leave */\n            const instruments = $(\"#nav-menu\").find(\".instruments\").on('mouseleave', refresh_active_symbols);\n            return chartable_markets;\n        });\n}\n\nexport const getMarketData = function() {\n    return markets;\n}\n\nexport const isMarketDataPresent = function(marketDataDisplayName, marketData) {\n    let present = false;\n    if (!marketData) {\n        marketData = markets;\n    }\n\n    const instrumentObj = this;\n    $.each(marketData, function(key, value) {\n        if (value.submarkets || value.instruments) {\n            present = instrumentObj.isMarketDataPresent(marketDataDisplayName, value.submarkets || value.instruments);\n        } else {\n            if ($.trim(value.display_name) == $.trim(marketDataDisplayName)) {\n                present = true;\n            }\n        }\n        return !present;\n    });\n    return present;\n}\n\nexport const getSpecificMarketData = function(marketDataDisplayName, marketData) {\n    let present = {};\n    if (!marketData) {\n        marketData = markets;\n    }\n\n    const instrumentObj = this;\n    $.each(marketData, function(key, value) {\n        if (value.submarkets || value.instruments) {\n            present = instrumentObj.getSpecificMarketData(marketDataDisplayName, value.submarkets || value.instruments);\n        } else {\n            if ($.trim(value.display_name) == $.trim(marketDataDisplayName)) {\n                present = value;\n            }\n        }\n        return $.isEmptyObject(present);\n    });\n    return present;\n}\n\nexport default {\n    init,\n    getMarketData,\n    isMarketDataPresent,\n    getSpecificMarketData\n}\n"]}