{"version":3,"sources":["../../../../../src/charts/indicators/indicatorManagement.es6"],"names":["ind_win","ind_win_view","state","formatters","array","cat","search","toLowerCase","filter","ind","category","indexOf","long_display_name","id","sort","a","b","indicators","map","flatten","uniq","value","init","Promise","resolve","reject","init_dialog_async","then","root","$","i18n","option","title","modal","destroy","unbind","dialog","remove","open","isAffiliates","extend","resizable","width","Math","min","window","height","ignoreTileAction","maximizable","minimizable","collapsable","createBlankWindow","init_state","container_id","is_tick_chart","current","favorites","clear_search","add","indicator","fields","copy","JSON","parse","stringify","indicator_id","require","edit","inx","splice","chart","highcharts","series","forEach","options","isInstrument","removeIndicator","series_ids","favorite","is_favorite","push","favorite_ids","local_storage","set","bind","update_indicators","get","isTickChartNotAllowed","seri","instance","ind_clone","cloneDeep","show","toString","name","shortName","showEdit","editable","getIDs","current_options","categories","first_time","openDialog","containerIDWithHash","data","time_period","isTick","normal_open","catch","console","error"],"mappings":"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","file":"indicatorManagement.js","sourcesContent":["/* created by amin, on May 20, 2016 */\nimport liveapi from 'websockets/binary_websockets';\nimport rv from 'common/rivetsExtra';\nimport _ from 'lodash';\nimport 'css!charts/indicators/indicatorManagement.css';\nimport root from 'text!charts/indicators/indicatorManagement.html';\nimport indicators_json from 'text!charts/indicators/indicators.json';\nimport indicatorBuilder from \"charts/indicators/indicatorBuilder\";\nimport windows from 'windows/windows';\n\nlet ind_win = null, ind_win_view = null, state = {};\n\n/* rviets formatter to filter indicators based on their category */\nrv.formatters['indicators-filter'] = (array, cat, search) => {\n  search = search && search.toLowerCase();\n  return array && array.filter((ind) => {\n    return ind.category.indexOf(cat) !== -1 &&\n      (ind.long_display_name.toLowerCase().indexOf(search) !== -1 ||\n        ind.id.toLowerCase().indexOf(search) !== -1);\n  }).sort((a, b) => {\n    if (a.long_display_name < b.long_display_name) return -1;\n    if (a.long_display_name > b.long_display_name) return +1;\n    return 0;\n  });\n};\nrv.formatters['indicators-favorites-filter'] = (array, search) => {\n  search = search && search.toLowerCase();\n  return array && array.filter((ind) => {\n    return (ind.long_display_name.toLowerCase().indexOf(search) !== -1 ||\n      ind.id.toLowerCase().indexOf(search) !== -1)\n  }).sort((a, b) => {\n    if (a.long_display_name < b.long_display_name) return -1;\n    if (a.long_display_name > b.long_display_name) return +1;\n    return 0;\n  });\n};\n/* rviets formatter to extract and filter categories */\nrv.formatters['indicators-categories'] = (array, search) => {\n  search = search && search.toLowerCase();\n  const indicators = array && array.filter((ind) => {\n    return (ind.long_display_name.toLowerCase().indexOf(search) !== -1 ||\n      ind.id.toLowerCase().indexOf(search) !== -1)\n  });\n  return indicators && _(indicators).map('category').flatten().uniq().value();\n};\n\nconst init = () => {\n  if (!ind_win)\n    return new Promise((resolve, reject) => {\n      init_dialog_async(root).then(resolve);\n    });\n  return Promise.resolve();\n}\n\nconst init_dialog_async = (root) => {\n  return new Promise((resolve, reject) => {\n    root = $(root).i18n();\n\n    let option = {\n      title: 'Add/remove indicators'.i18n(),\n      modal: true,\n      destroy: () => {\n        ind_win_view && ind_win_view.unbind();\n        ind_win_view = null;\n        ind_win.dialog('destroy').remove();\n        ind_win = null;\n      },\n      open: () => { },\n    };\n\n    /* affiliates route */\n    if (isAffiliates()) {\n      option = _.extend(option, {\n        resizable: false,\n        width: Math.min(480, $(window).width() - 10),\n        height: 400,\n        ignoreTileAction: true,\n        maximizable: false,\n        minimizable: false,\n        collapsable: false,\n      });\n    }\n    /* normal route */\n    else {\n      option = _.extend(option, {\n        width: 700,\n        // minHeight: 60,\n      })\n    }\n    ind_win = windows.createBlankWindow(root, option);\n    init_state(root);\n    resolve();\n  });\n}\n\nconst init_state = (root) => {\n  state = {\n    dialog: {\n      title: 'Add/remove indicators'.i18n(),\n      container_id: '',\n      is_tick_chart: false\n    },\n    indicators: {\n      search: '',\n      array: [],\n      current: [],\n      favorites: []\n    },\n  };\n\n  state.indicators.clear_search = () => { state.indicators.search = ''; }\n\n  state.indicators.add = (indicator) => {\n    if (indicator.fields) { /* use indicatorBuilder.es6 */\n      const copy = JSON.parse(JSON.stringify(indicator));\n      indicatorBuilder.open(copy, state.dialog.container_id)\n    }\n    else {\n      const indicator_id = indicator.id;\n      require([\"charts/indicators/\" + indicator_id + \"/\" + indicator_id], (ind) => {\n        ind.open(state.dialog.container_id);\n      });\n    }\n    ind_win.dialog('close');\n  }\n\n  state.indicators.edit = (indicator) => {\n    if (indicator.fields) { /* use indicatorBuilder.es6 */\n      const copy = JSON.parse(JSON.stringify(indicator));\n      indicatorBuilder.open(copy, state.dialog.container_id, () => {\n        state.indicators.remove(indicator);\n      })\n    }\n    else {\n      const indicator_id = indicator.id;\n      require([\"charts/indicators/\" + indicator_id + \"/\" + indicator_id], (ind) => {\n        ind.open(state.dialog.container_id, () => {\n          state.indicators.remove(indicator);\n        });\n      });\n    }\n    ind_win.dialog('close');\n  }\n\n  state.indicators.remove = (indicator) => {\n    const inx = state.indicators.current.indexOf(indicator);\n    inx !== -1 && state.indicators.current.splice(inx, 1);\n\n    const chart = $(state.dialog.container_id).highcharts();\n    chart.series.forEach((series) => {\n      if (series.options.isInstrument) {\n        series.removeIndicator(indicator.series_ids);\n      }\n    });\n  }\n\n  state.indicators.favorite = (indicator) => {\n    if (indicator.is_favorite) {\n      indicator.is_favorite = false;\n      const inx = state.indicators.favorites.indexOf(indicator);\n      state.indicators.favorites.splice(inx, 1);\n    }\n    else {\n      indicator.is_favorite = true;\n      state.indicators.favorites.push(indicator);\n    }\n\n    const favorite_ids = state.indicators.favorites.map((ind) => { return ind.id; });\n    local_storage.set('indicator-management-favorite-ids', JSON.stringify(favorite_ids));\n  }\n\n  ind_win_view = rv.bind(root[0], state);\n}\n\nconst update_indicators = (series) => {\n  let indicators = JSON.parse(indicators_json);\n  const favorite_ids = local_storage.get('indicator-management-favorite-ids') || [];\n  indicators = _.filter(indicators, (ind) => {\n    ind.is_favorite = favorite_ids.indexOf(ind.id) !== -1;\n    return !(ind.isTickChartNotAllowed && state.dialog.is_tick_chart);\n  });\n\n  let current = [];\n  indicators.forEach((ind) => {\n    series.forEach((seri) => {\n      seri[ind.id] && seri[ind.id].forEach((instance) => {\n        const ind_clone = _.cloneDeep(ind);\n        //Show suffix if it is different than the long_display_name\n        const show = ind.long_display_name !== instance.toString();\n        ind_clone.name = ind.long_display_name;\n        ind_clone.shortName = (show ? instance.toString() : \"\");\n        ind_clone.showEdit = ind.editable;\n        ind_clone.series_ids = instance.getIDs()\n        ind_clone.current_options = _.cloneDeep(instance.options); /* used in indicatorBuilder.es6 */\n        current.push(ind_clone);\n      });\n    });\n  });\n\n  state.categories = _(indicators).map('category').flatten().uniq().value();\n  state.indicators.favorites = _.filter(indicators, 'is_favorite');\n  state.indicators.array = indicators;\n  state.indicators.current = current;\n}\n\nlet first_time = true;\nexport const openDialog = (containerIDWithHash, title) => {\n  init().then(() => {\n    state.dialog.title = 'Add/remove indicators'.i18n() + (title ? ' - ' + title : '');\n    state.dialog.container_id = containerIDWithHash;\n    state.indicators.current = $(containerIDWithHash).data('indicators-current') || [];\n    const time_period = $(containerIDWithHash).data('timePeriod');\n    state.dialog.is_tick_chart = isTick(time_period);\n\n    let series = $(containerIDWithHash).highcharts().series;\n    series = _.filter(series, 'options.isInstrument');\n    update_indicators(series);\n    const normal_open = first_time || isAffiliates();\n    ind_win.dialog('open')\n    first_time = false;\n  }).catch(console.error.bind(console));\n}\n\nexport default {\n  openDialog\n}\n"]}