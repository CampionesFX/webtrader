{"version":3,"sources":["../../../../src/trade/tradeMenu.es6"],"names":["show_error","err","growl","error","message","console","refresh_active_symbols","send","active_symbols","then","data","isChampionFx","_","remove","markets","groupBy","map","symbols","sym","head","market","name","display_name","market_display_name","submarkets","submarket","submarket_display_name","instruments","symbol","is_disabled","is_trading_suspended","exchange_is_open","pip","every","value","sortMenu","trade","find","root","appendTo","refreshMenu","li","contracts_for","res","require","tradeDialog","init","catch","liveapi","events","on"],"mappings":"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","file":"tradeMenu.js","sourcesContent":["ï»¿/**\n * Created by amin on October 30, 2015.\n */\nimport $ from 'jquery';\nimport lodash from 'lodash';\nimport liveapi from '../websockets/binary_websockets';\nimport menu from '../navigation/menu';\nimport \"jquery-growl\";\n\nconst show_error = (err) => {\n   $.growl.error({ message: err.message });\n   console.error(err);\n};\nconst refresh_active_symbols = () => {\n   liveapi\n      .send({ active_symbols: 'brief', \"landing_company\": \"champion\" })\n      .then((data) => {\n         // remove volatility for champion-fx.\n         if(isChampionFx())\n            _.remove(data.active_symbols, ['market','volidx']);\n         /* clean up the data! */\n         let markets = _(data.active_symbols).groupBy('market').map((symbols) => {\n            const sym = _.head(symbols);\n            const market = { name: sym.market, display_name: sym.market_display_name };\n            market.submarkets = _(symbols).groupBy('submarket').map((symbols) => {\n               const sym = _.head(symbols);\n               const submarket = { name: sym.submarket, display_name: sym.submarket_display_name };\n               submarket.instruments = _.map(symbols,(sym) => ({\n                     symbol: sym.symbol,\n                     display_name: sym.display_name,\n                     is_disabled: sym.is_trading_suspended || !sym.exchange_is_open,\n                     pip: sym.pip\n                  })\n               );\n               submarket.is_disabled = _.every(submarket.instruments, 'is_disabled');\n               return submarket;\n            }).value();\n            market.is_disabled = _.every(market.submarkets, 'is_disabled');\n            return market;\n         }).value();\n         markets = menu.sortMenu(markets);\n\n         const trade = $(\"#nav-menu\").find(\".trade\");\n         trade.find('> ul').remove();\n         const root = $(\"<ul>\").appendTo(trade); /* add to trade menu */\n         menu.refreshMenu(root, markets, (li) => {\n            const data = li.data();\n            liveapi\n               .send({ contracts_for: data.symbol })\n               .then((res) => {\n                  require(['trade/tradeDialog'],\n                     (tradeDialog) => tradeDialog.init(data, res.contracts_for)\n                  );\n               }).catch(show_error);\n         });\n      })\n      .catch(show_error);\n}\n\nexport const init = () => {\n   require(['trade/tradeDialog']); // Trigger loading of tradeDialog\n   refresh_active_symbols();\n   require(['websockets/binary_websockets'], (liveapi) => {\n      liveapi.events.on('login', refresh_active_symbols);\n      liveapi.events.on('logout', refresh_active_symbols);\n   });\n   /* refresh menu on mouse leave */\n   const trade = $(\"#nav-menu\").find(\".trade\").on('mouseleave', refresh_active_symbols);\n}\n\nexport default  { init };\n"]}