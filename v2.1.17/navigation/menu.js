define(["exports","jquery","lodash","./navigation","../common/util"],function(a,b,c,d){"use strict";function e(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(a,"__esModule",{value:!0}),a.refreshMenu=a.sortMenu=a.extractChartableMarkets=a.extractFilteredMarkets=void 0;var f=e(b),g=e(c),h=e(d),i=function n(a,b,c){b.forEach(function(b){var d=b.submarkets||b.instruments,e="<span class='nav-submenu-caret'></span>",g=d?b.display_name+e:b.display_name,h=f["default"]("<a href='#'>"+g+"</a>");b.is_disabled&&h.addClass("disabled");var i=f["default"]("<li>").append(h);if(d||i.data(b),i.appendTo(a),d){var j=f["default"]("<ul>");j.appendTo(i),n(j,b.submarkets||b.instruments,c)}else c&&!b.is_disabled&&h.click(function(){var a=f["default"](this).parent();c(a)})})},j=a.extractFilteredMarkets=function(a,b){var c=a.trading_times.markets.map(function(a){var c={name:a.name,display_name:a.name};return c.submarkets=a.submarkets.map(function(a){var c={name:a.name,display_name:a.name},d=a.symbols;return b&&b.filter&&(d=d.filter(b.filter)),c.instruments=d.map(function(a){return{symbol:a.symbol,display_name:a.name,delay_amount:a.delay_amount||0,events:a.events,times:a.times,settlement:a.settlement,feed_license:a.feed_license||"realtime"}}),c}).filter(function(a){return a.instruments.length>0}),c});return c},k=a.extractChartableMarkets=function(a){return j(a,{filter:function(a){return"chartonly"!==a.feed_license}})||[]},l=a.sortMenu=function(a){var b=sortAlphaNum("display_name");if(f["default"].isArray(a)){var c={forex:1,indices:2,stocks:3,commodities:4,volidx:5};a=g["default"].sortBy(a,function(a){return c[a.name.toLowerCase()]}),a.forEach(function(a){f["default"].isArray(a.submarkets)&&(a.submarkets.sort(b),a.submarkets.forEach(function(a){f["default"].isArray(a.instruments)&&a.instruments.sort(b)}))})}return a},m=a.refreshMenu=function(a,b,c){i(a,b,c),h["default"].updateDropdownToggles()};a["default"]={extractChartableMarkets:k,extractFilteredMarkets:j,sortMenu:l,refreshMenu:m}});