define(["exports","jquery","websockets/binary_websockets","windows/windows","cashier/currency","common/rivetsExtra","lodash","moment"],function(a,b,c,d,e,f,g,h){"use strict";function i(a){return a&&a.__esModule?a:{"default":a}}function j(a){a.click(function(){s?s.moveToTop():n["default"].cached.authorize().then(function(a){return a.authorize.currency?!0:p["default"].check_currency()}).then(function(){return require(["text!cashier/deposit.html"],k)})["catch"](u)})}function k(a){a=m["default"](a).i18n(),s=o["default"].createBlankWindow(a,{title:"Deposit funds",resizable:!0,collapsable:!1,minimizable:!0,maximizable:!0,width:700,height:600,"data-authorized":!0,close:function(){s.dialog("destroy"),s.trigger("dialogclose"),s.remove(),s=null},open:function(){},destroy:function(){t&&t.unbind(),t=null}}),l(a),s.dialog("open");var b=s.dialog("widget").offset();b.top=110,s.dialog("option","position",{my:b.left,at:b.top}),s.dialog("widget").css({left:b.left+"px",top:b.top+"px"}),s.fixFooterPosition(),s.track({module_id:"deposit",is_unique:!0})}function l(a){var b=(n["default"].app_id,{route:{value:"standard-methods"},empty_fields:{validate:!1,clear:r["default"].debounce(function(){b.empty_fields.validate=!1},4e3),show:function(){b.empty_fields.validate=!0,b.empty_fields.clear()}},user:{email:local_storage.get("authorize").email,cashier_url:"",residence:"",residence_name:""},standard_methods:{iframe_visible:!1},payment_agents:{list:[],current:{}}});b.route.update=function(a){b.route.value=a},b.standard_methods.iframe_loaded=function(){b.user.cashier_url&&(b.standard_methods.iframe_visible=!0)},b.payment_agents.get_commission_text=function(a){return a.deposit_commission===a.withdrawal_commission?a.deposit_commission+"% "+"commission".i18n():a.deposit_commission+"% "+"deposits".i18n()+" / "+a.withdrawal_commission+"% "+"withdrawals".i18n()},b.payment_agents.onclick=function(a,c){var d=m["default"](c.target).next(),e=b.payment_agents.elem;e&&e.css("max-height","0"),b.payment_agents.current.is_active=!1,b.payment_agents.current===a?b.payment_agents.current={}:(b.payment_agents.current=a,b.payment_agents.elem=d,d.css("max-height",d[0].scrollHeight+"px"),a.is_active=!0)},t=q["default"].bind(a[0],b),n["default"].send({cashier:"deposit"}).then(function(a){b.user.cashier_url=a.cashier})["catch"](u);var c=n["default"].send({get_settings:1}).then(function(a){b.user.residence=a.get_settings.country_code,b.user.residence_name=a.get_settings.country})["catch"](u);c.then(function(){return b.user.residence?n["default"].send({paymentagent_list:b.user.residence}):{paymentagent_list:{list:[]}}}).then(function(a){var c=a.paymentagent_list.list.map(function(a){return a.commission_text=b.payment_agents.get_commission_text(a),a.supported_banks=a.supported_banks.toLowerCase().split(","),a});b.payment_agents.list=c})["catch"](u)}Object.defineProperty(a,"__esModule",{value:!0}),a.init=j;{var m=i(b),n=i(c),o=i(d),p=i(e),q=i(f),r=i(g);i(h)}require(["text!cashier/deposit.html"]),require(["css!cashier/deposit.css"]);var s=null,t=null,u=function(a){m["default"].growl.error({message:a.message})};a["default"]={init:j}});